---
title: Schema Definition
description: Define tables, relations, and type-safe schemas with Better-Convex ORM
links:
  doc: https://orm.drizzle.team/docs/sql-schema-declaration
---

import { InfoIcon, CheckCircle, AlertTriangle } from "lucide-react"

Define your schema with Drizzle‑style table builders and relations. Better‑Convex keeps the API familiar while adapting it to Convex’s document model.

## Overview

| Feature | Drizzle v1 | Better‑Convex |
|---|---|---|
| Table definition | `pgTable()` | `convexTable()` |
| Relations | `defineRelations()` | `defineRelations()` |
| Type inference | Automatic | Automatic |
| Field types | Column builders | Column builders |

## Table Definition

```ts title="convex/schema.ts"
import { convexTable, text, integer, boolean, id } from 'better-convex/orm';

export const users = convexTable('users', {
  name: text().notNull(),
  email: text().notNull(),
  age: integer(),
  isAdmin: boolean(),
});
```

**Auto‑generated fields:**
- `_id: Id<'table'>`
- `_creationTime: number`

### Nullability

Fields are nullable by default. Add `.notNull()` for required fields.

```ts
const users = convexTable('users', {
  name: text().notNull(), // string
  bio: text(),            // string | null
});
```

### Column Builder Types

| TypeScript Type | Builder |
|---|---|
| `string | null` | `text()` |
| `string` | `text().notNull()` |
| `number | null` | `integer()` or `number()` |
| `number` | `integer().notNull()` or `number().notNull()` |
| `boolean | null` | `boolean()` |
| `boolean` | `boolean().notNull()` |
| `bigint | null` | `bigint()` |
| `Id<'users'> | null` | `id('users')` |
| `Id<'users'>` | `id('users').notNull()` |
| `number[] | null` | `vector(1536)` |
| `number[]` | `vector(1536).notNull()` |

## Relations

Use Drizzle‑style `defineRelations()` with `_id` references.

```ts title="convex/schema.ts"
import { defineRelations, extractRelationsConfig } from 'better-convex/orm';

export const posts = convexTable('posts', {
  title: text().notNull(),
  authorId: id('users'),
});

export const ormSchema = defineRelations({ users, posts }, (r) => ({
  users: { posts: r.many.posts() },
  posts: {
    author: r.one.users({ from: r.posts.authorId, to: r.users._id }),
  },
}));

export const ormEdges = extractRelationsConfig(ormSchema);
```

## Indexes

Add indexes for fields you filter or sort by.

```ts
import { convexTable, text, id, index } from 'better-convex/orm';

const posts = convexTable(
  'posts',
  {
    title: text().notNull(),
    authorId: id('users'),
  },
  (t) => [index('by_author').on(t.authorId)]
);
```

### Search Indexes

```ts
import { convexTable, text, id, searchIndex } from 'better-convex/orm';

const posts = convexTable(
  'posts',
  {
    title: text().notNull(),
    authorId: id('users'),
  },
  (t) => [searchIndex('by_text').on(t.title).filter(t.authorId)]
);
```

### Vector Indexes (wip)

```ts
import { convexTable, id, vector, vectorIndex } from 'better-convex/orm';

const posts = convexTable(
  'posts',
  {
    authorId: id('users'),
    embedding: vector(1536).notNull(),
  },
  (t) => [
    vectorIndex('embedding_vec')
      .on(t.embedding)
      .dimensions(1536)
      .filter(t.authorId),
  ]
);
```

Better‑Convex mirrors Convex’s vector search API with Drizzle‑style builders. Use `vector(dimensions)` for embedding fields.

**Common errors:**
- Missing `.on(...)` → "Did you forget to call .on(...)?"
- Missing `.dimensions(n)` on vector indexes → "missing dimensions"

## Constraints And Defaults

- Defaults set with `.default(...)` are applied by Better‑Convex inserts
- `unique()` and column `.unique()` are enforced at runtime (ORM mutations only)
- `foreignKey()` and column `.references()` are enforced at runtime (ORM mutations only)
- Check constraints are not enforced

<Callout icon={<AlertTriangle />}>
**Unique and foreign key constraints** are enforced only by ORM mutations. Direct `ctx.db` writes bypass these checks. For non‑`_id` foreign keys, add an index on the referenced columns.
</Callout>

## Common Gotchas

| Issue | Fix |
|---|---|
| Defining `_id` manually | Convex creates `_id` automatically |
| Fields unexpectedly nullable | Use `.notNull()` |
| Relations not loading | Define both sides and export `ormEdges` |
| Slow ordering | Add `index('...').on(t.field)` for the primary `orderBy` field |

## Next Steps

<Cards>
  <Card title="Relations" href="/docs/db/orm/relations">
    One‑to‑one, one‑to‑many, many‑to‑many
  </Card>
  <Card title="Querying Data" href="/docs/db/orm/queries">
    Filters, ordering, pagination
  </Card>
  <Card title="API Reference" href="/docs/db/orm/api-reference">
    Full API surface
  </Card>
  <Card title="Limitations" href="/docs/db/orm/limitations">
    Differences and tradeoffs
  </Card>
</Cards>
